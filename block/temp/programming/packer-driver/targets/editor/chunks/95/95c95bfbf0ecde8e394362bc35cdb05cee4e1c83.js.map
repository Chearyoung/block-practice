{"version":3,"sources":["file:///Users/jhh/Desktop/projects/block_project/block-practice/block/assets/script/scene/MainScene.ts"],"names":["_decorator","Component","Node","Input","game","v3","tween","WeaponManager","GridMapManager","GridManager","TemplateMgr","GridData","GameDefine","EventConstant","ccclass","property","MainScene","start","scheduleOnce","instance","init","gridManager","gridMapManager","weaponManager","onTouchStart","event","gameTouch","preventSwallow","wpos","getUILocation","emit","GAME_TOUCH_START","onTouchMove","GAME_TOUCH_MOVE","onTouchEnd","GAME_TOUCH_END","onTapBtn","setTweenAnim","removeWeaponList","main","duration","active","setScale","to","scale","easing","call","onRerollBtn","WEAPON_REMOVE_REFRESH","onToucWeaponBg","refresh","confirm","onPlaceFinishBtn","PLACE_GRID_FINISH","onEnable","gameCtrl","on","EventType","TOUCH_START","TOUCH_MOVE","TOUCH_END","GAME_TAP_BTN","TOUCH_WEAPONBG","onDisable","off"],"mappings":"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","sourcesContent":["import { _decorator, Component, Node, Input, game, EventTouch, v3,tween} from 'cc';\nimport { WeaponManager } from \"../Mgr/WeaponManager\";\nimport { GridMapManager } from '../block//Mgr/GridMapManager';\nimport { GridManager } from '../block/Mgr/GridManager';\nimport { TemplateMgr } from \"../Mgr/TemplateMgr\";\nimport { GridData } from \"../Data/GridData\";\nimport { GameDefine } from '../GameDefine';\nimport { EventConstant } from '../EventConstant';\nconst { ccclass, property } = _decorator;\n\n@ccclass('MainScene')\nexport class MainScene extends Component {\n\n    @property(Node)\n    gameCtrl: Node = null!;\n\n    @property(Node)\n    refresh: Node = null!;\n\n\n    @property(Node)\n    confirm: Node = null!;\n\n\n    @property(Node)\n    removeWeaponList: Node = null!;\n\n    @property(GridMapManager)\n    gridMapManager: GridMapManager = null!;\n\n    @property(GridManager)\n    gridManager: GridManager = null!;\n\n    @property(WeaponManager)\n    weaponManager: WeaponManager = null!;\n    start() {\n        this.scheduleOnce(() => {\n            // 加载配置表\n            TemplateMgr.instance().init(() => {\n                GridData.instance.init();\n                this.gridManager.init();\n                this.gridMapManager.init();\n                this.weaponManager.init();\n            })\n        }, 0.5)\n\n    }\n    private onTouchStart(event: EventTouch) {\n        GameDefine.gameTouch = true;\n        event.preventSwallow = true;\n        if (GameDefine.gameTouch) {\n            let wpos = event.getUILocation();\n            game.emit(EventConstant.GAME_TOUCH_START, wpos);\n        }\n    }\n\n    /* 触摸移动 */\n    private onTouchMove(event: EventTouch) {\n        event.preventSwallow = true;\n        if (GameDefine.gameTouch) {\n            let wpos = event.getUILocation();\n            game.emit(EventConstant.GAME_TOUCH_MOVE, wpos);\n        }\n    }\n\n    /* 触摸结束 */\n    private onTouchEnd(event: EventTouch) {\n        GameDefine.gameTouch = true;       event.preventSwallow = true;\n        if (GameDefine.gameTouch) {\n            let wpos = event.getUILocation();\n            game.emit(EventConstant.GAME_TOUCH_END, wpos);\n        }\n        GameDefine.gameTouch = false;\n    }\n\n\n    private onTapBtn() {\n        GameDefine.gameTouch = true;\n        this.setTweenAnim(this.removeWeaponList, 0.3);\n    }\n\n    private setTweenAnim(main: Node, duration: number) {\n        main.active = true;\n        main.setScale(0.5, 0.5);\n        tween(main)\n            .to(duration, { scale: v3(1, 1, 1) }, { easing: 'backOut' })\n            .call(() => {\n                // 弹窗已完全展示\n            })\n            .start();\n    }\n\n    public onRerollBtn() {\n        game.emit(EventConstant.WEAPON_REMOVE_REFRESH);\n    }\n\n    onToucWeaponBg(){\n        this.refresh.active = false;\n        this.confirm.active = true;\n    }\n\n    public onPlaceFinishBtn() {\n        game.emit(EventConstant.PLACE_GRID_FINISH);\n        this.refresh.active = true;\n        this.confirm.active = false;\n    }\n\n    protected onEnable(): void {\n        this.gameCtrl.on(Input.EventType.TOUCH_START, this.onTouchStart, this);\n        this.gameCtrl.on(Input.EventType.TOUCH_MOVE, this.onTouchMove, this);\n        this.gameCtrl.on(Input.EventType.TOUCH_END, this.onTouchEnd, this);\n        game.on(EventConstant.GAME_TAP_BTN, this.onTapBtn, this);\n        game.on(EventConstant.TOUCH_WEAPONBG, this.onToucWeaponBg, this);\n    }\n\n    protected onDisable(): void {\n        this.gameCtrl.off(Input.EventType.TOUCH_START, this.onTouchStart, this);\n        this.gameCtrl.off(Input.EventType.TOUCH_MOVE, this.onTouchMove, this);\n        this.gameCtrl.off(Input.EventType.TOUCH_END, this.onTouchEnd, this);\n        game.off(EventConstant.GAME_TAP_BTN, this.onTapBtn, this);\n        game.off(EventConstant.TOUCH_WEAPONBG, this.onToucWeaponBg, this);\n    }\n}\n\n"]}