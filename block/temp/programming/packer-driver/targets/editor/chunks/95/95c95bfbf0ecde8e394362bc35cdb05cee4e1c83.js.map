{"version":3,"sources":["file:///Users/jhh/Desktop/projects/block_project/block-practice/block/assets/script/scene/MainScene.ts"],"names":["_decorator","Component","Node","Input","game","v3","tween","WeaponManager","TemplateMgr","GridData","GameDefine","EventConstant","ccclass","property","MainScene","start","scheduleOnce","instance","init","weaponManager","onTouchStart","event","gameTouch","preventSwallow","wpos","getUILocation","emit","GAME_TOUCH_START","onTouchMove","GAME_TOUCH_MOVE","onTouchEnd","GAME_TOUCH_END","onTapBtn","setTweenAnim","removeWeaponList","main","duration","active","setScale","to","scale","easing","call","onRerollBtn","WEAPON_REMOVE_REFRESH","onEnable","gameCtrl","on","EventType","TOUCH_START","TOUCH_MOVE","TOUCH_END","GAME_TAP_BTN","onDisable","off"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAASA,MAAAA,U,OAAAA,U;AAAYC,MAAAA,S,OAAAA,S;AAAWC,MAAAA,I,OAAAA,I;AAAMC,MAAAA,K,OAAAA,K;AAAOC,MAAAA,I,OAAAA,I;AAAkBC,MAAAA,E,OAAAA,E;AAAGC,MAAAA,K,OAAAA,K;;AACzDC,MAAAA,a,iBAAAA,a;;AACAC,MAAAA,W,iBAAAA,W;;AACAC,MAAAA,Q,iBAAAA,Q;;AACAC,MAAAA,U,iBAAAA,U;;AACAC,MAAAA,a,iBAAAA,a;;;;;;;;;OACH;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBb,U;;2BAGjBc,S,WADZF,OAAO,CAAC,WAAD,C,UAGHC,QAAQ,CAACX,IAAD,C,UAGRW,QAAQ,CAACX,IAAD,C,UAGRW,QAAQ;AAAA;AAAA,yC,2BATb,MACaC,SADb,SAC+Bb,SAD/B,CACyC;AAAA;AAAA;;AAAA;;AAAA;;AAAA;AAAA;;AAUrCc,QAAAA,KAAK,GAAG;AACJ,eAAKC,YAAL,CAAkB,MAAM;AACpB;AACA;AAAA;AAAA,4CAAYC,QAAZ,GAAuBC,IAAvB,CAA4B,MAAM;AAC9B;AAAA;AAAA,wCAASD,QAAT,CAAkBC,IAAlB;AACA,mBAAKC,aAAL,CAAmBD,IAAnB;AACH,aAHD;AAIH,WAND,EAMG,GANH;AAQH;;AACOE,QAAAA,YAAY,CAACC,KAAD,EAAoB;AACpC;AAAA;AAAA,wCAAWC,SAAX,GAAuB,IAAvB;AACAD,UAAAA,KAAK,CAACE,cAAN,GAAuB,IAAvB;;AACA,cAAI;AAAA;AAAA,wCAAWD,SAAf,EAA0B;AACtB,gBAAIE,IAAI,GAAGH,KAAK,CAACI,aAAN,EAAX;AACArB,YAAAA,IAAI,CAACsB,IAAL,CAAU;AAAA;AAAA,gDAAcC,gBAAxB,EAA0CH,IAA1C;AACH;AACJ;AAED;;;AACQI,QAAAA,WAAW,CAACP,KAAD,EAAoB;AACnCA,UAAAA,KAAK,CAACE,cAAN,GAAuB,IAAvB;;AACA,cAAI;AAAA;AAAA,wCAAWD,SAAf,EAA0B;AACtB,gBAAIE,IAAI,GAAGH,KAAK,CAACI,aAAN,EAAX;AACArB,YAAAA,IAAI,CAACsB,IAAL,CAAU;AAAA;AAAA,gDAAcG,eAAxB,EAAyCL,IAAzC;AACH;AACJ;AAED;;;AACQM,QAAAA,UAAU,CAACT,KAAD,EAAoB;AAClC;AAAA;AAAA,wCAAWC,SAAX,GAAuB,IAAvB;AAAmCD,UAAAA,KAAK,CAACE,cAAN,GAAuB,IAAvB;;AACnC,cAAI;AAAA;AAAA,wCAAWD,SAAf,EAA0B;AACtB,gBAAIE,IAAI,GAAGH,KAAK,CAACI,aAAN,EAAX;AACArB,YAAAA,IAAI,CAACsB,IAAL,CAAU;AAAA;AAAA,gDAAcK,cAAxB,EAAwCP,IAAxC;AACH;;AACD;AAAA;AAAA,wCAAWF,SAAX,GAAuB,KAAvB;AACH;;AAGOU,QAAAA,QAAQ,GAAG;AACf;AAAA;AAAA,wCAAWV,SAAX,GAAuB,IAAvB;AACA,eAAKW,YAAL,CAAkB,KAAKC,gBAAvB,EAAyC,GAAzC;AACH;;AAEOD,QAAAA,YAAY,CAACE,IAAD,EAAaC,QAAb,EAA+B;AAC/CD,UAAAA,IAAI,CAACE,MAAL,GAAc,IAAd;AACAF,UAAAA,IAAI,CAACG,QAAL,CAAc,GAAd,EAAmB,GAAnB;AACAhC,UAAAA,KAAK,CAAC6B,IAAD,CAAL,CACKI,EADL,CACQH,QADR,EACkB;AAAEI,YAAAA,KAAK,EAAEnC,EAAE,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP;AAAX,WADlB,EAC0C;AAAEoC,YAAAA,MAAM,EAAE;AAAV,WAD1C,EAEKC,IAFL,CAEU,MAAM,CACR;AACH,WAJL,EAKK3B,KALL;AAMH;;AAEM4B,QAAAA,WAAW,GAAG;AACjBvC,UAAAA,IAAI,CAACsB,IAAL,CAAU;AAAA;AAAA,8CAAckB,qBAAxB;AACH;;AAESC,QAAAA,QAAQ,GAAS;AACvB,eAAKC,QAAL,CAAcC,EAAd,CAAiB5C,KAAK,CAAC6C,SAAN,CAAgBC,WAAjC,EAA8C,KAAK7B,YAAnD,EAAiE,IAAjE;AACA,eAAK0B,QAAL,CAAcC,EAAd,CAAiB5C,KAAK,CAAC6C,SAAN,CAAgBE,UAAjC,EAA6C,KAAKtB,WAAlD,EAA+D,IAA/D;AACA,eAAKkB,QAAL,CAAcC,EAAd,CAAiB5C,KAAK,CAAC6C,SAAN,CAAgBG,SAAjC,EAA4C,KAAKrB,UAAjD,EAA6D,IAA7D;AACA1B,UAAAA,IAAI,CAAC2C,EAAL,CAAQ;AAAA;AAAA,8CAAcK,YAAtB,EAAoC,KAAKpB,QAAzC,EAAmD,IAAnD;AACH;;AAESqB,QAAAA,SAAS,GAAS;AACxB,eAAKP,QAAL,CAAcQ,GAAd,CAAkBnD,KAAK,CAAC6C,SAAN,CAAgBC,WAAlC,EAA+C,KAAK7B,YAApD,EAAkE,IAAlE;AACA,eAAK0B,QAAL,CAAcQ,GAAd,CAAkBnD,KAAK,CAAC6C,SAAN,CAAgBE,UAAlC,EAA8C,KAAKtB,WAAnD,EAAgE,IAAhE;AACA,eAAKkB,QAAL,CAAcQ,GAAd,CAAkBnD,KAAK,CAAC6C,SAAN,CAAgBG,SAAlC,EAA6C,KAAKrB,UAAlD,EAA8D,IAA9D;AACA1B,UAAAA,IAAI,CAACkD,GAAL,CAAS;AAAA;AAAA,8CAAcF,YAAvB,EAAqC,KAAKpB,QAA1C,EAAoD,IAApD;AACH;;AAjFoC,O;;;;;iBAGpB,I;;;;;;;iBAGQ,I;;;;;;;iBAGM,I","sourcesContent":["import { _decorator, Component, Node, Input, game, EventTouch, v3,tween} from 'cc';\nimport { WeaponManager } from \"../Mgr/WeaponManager\";\nimport { TemplateMgr } from \"../Mgr/TemplateMgr\";\nimport { GridData } from \"../Data/GridData\";\nimport { GameDefine } from '../GameDefine';\nimport { EventConstant } from '../EventConstant';\nconst { ccclass, property } = _decorator;\n\n@ccclass('MainScene')\nexport class MainScene extends Component {\n\n    @property(Node)\n    gameCtrl: Node = null!;\n\n    @property(Node)\n    removeWeaponList: Node = null!;\n\n    @property(WeaponManager)\n    weaponManager: WeaponManager = null!;\n    start() {\n        this.scheduleOnce(() => {\n            // 加载配置表\n            TemplateMgr.instance().init(() => {\n                GridData.instance.init();\n                this.weaponManager.init();\n            })\n        }, 0.5)\n\n    }\n    private onTouchStart(event: EventTouch) {\n        GameDefine.gameTouch = true;\n        event.preventSwallow = true;\n        if (GameDefine.gameTouch) {\n            let wpos = event.getUILocation();\n            game.emit(EventConstant.GAME_TOUCH_START, wpos);\n        }\n    }\n\n    /* 触摸移动 */\n    private onTouchMove(event: EventTouch) {\n        event.preventSwallow = true;\n        if (GameDefine.gameTouch) {\n            let wpos = event.getUILocation();\n            game.emit(EventConstant.GAME_TOUCH_MOVE, wpos);\n        }\n    }\n\n    /* 触摸结束 */\n    private onTouchEnd(event: EventTouch) {\n        GameDefine.gameTouch = true;       event.preventSwallow = true;\n        if (GameDefine.gameTouch) {\n            let wpos = event.getUILocation();\n            game.emit(EventConstant.GAME_TOUCH_END, wpos);\n        }\n        GameDefine.gameTouch = false;\n    }\n\n\n    private onTapBtn() {\n        GameDefine.gameTouch = true;\n        this.setTweenAnim(this.removeWeaponList, 0.3);\n    }\n\n    private setTweenAnim(main: Node, duration: number) {\n        main.active = true;\n        main.setScale(0.5, 0.5);\n        tween(main)\n            .to(duration, { scale: v3(1, 1, 1) }, { easing: 'backOut' })\n            .call(() => {\n                // 弹窗已完全展示\n            })\n            .start();\n    }\n\n    public onRerollBtn() {\n        game.emit(EventConstant.WEAPON_REMOVE_REFRESH);\n    }\n\n    protected onEnable(): void {\n        this.gameCtrl.on(Input.EventType.TOUCH_START, this.onTouchStart, this);\n        this.gameCtrl.on(Input.EventType.TOUCH_MOVE, this.onTouchMove, this);\n        this.gameCtrl.on(Input.EventType.TOUCH_END, this.onTouchEnd, this);\n        game.on(EventConstant.GAME_TAP_BTN, this.onTapBtn, this);\n    }\n\n    protected onDisable(): void {\n        this.gameCtrl.off(Input.EventType.TOUCH_START, this.onTouchStart, this);\n        this.gameCtrl.off(Input.EventType.TOUCH_MOVE, this.onTouchMove, this);\n        this.gameCtrl.off(Input.EventType.TOUCH_END, this.onTouchEnd, this);\n        game.off(EventConstant.GAME_TAP_BTN, this.onTapBtn, this);\n    }\n}\n\n"]}