{"version":3,"sources":["file:///Users/jhh/Desktop/projects/block_project/block-practice/block/assets/script/Data/WeaponData.ts"],"names":["WeaponData","CoinObj","Vec3","Templates","_isSelect","_weaponCfgMapData","Map","_weaponGridData","isSelect","value","init","blockItems","TbBlockItem","getDataList","weaponModels","i","length","weaponModel","tempId","id","Name","name","Res","icon","weaponGroupNum","group","itemType","type","toString","Type","shapeType","SkillId","targetId","Level","level","Points","shapeTypePara","options_num","optionsNum","push","index","element","key","set","getWeaponCfgByLevel","get","checkWeaponByLevel","has","getWeaponCfgById","blockItem","getDataMap","getWeaponCfgData","data","getWeaponPool","arr","countRegionOccurrences","matrix","region","count","regionRows","regionCols","j","match","r","c","getPlaceGridIdByWeigh","weaponData","size","forEach","weaponCfg","placeId","start","end","sum","rand","Math","floor","random","some","item","idx","clear","instance","_instance","wpos","num"],"mappings":"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","sourcesContent":["import { Vec3 } from \"cc\";\r\nimport { Templates } from \"../Mgr/TemplateMgr\";\r\n\r\n\r\nexport interface WeaponModel {\r\n    ClassName?: string;\r\n    /** id */\r\n    tempId: number;\r\n    Name: string;\r\n    Res: string;\r\n    //物品组\r\n    weaponGroupNum: number;\r\n    itemType: string;\r\n    /* 格子点类型 */\r\n    Type: string;\r\n    SkillId: number;\r\n    Level: number;\r\n    /* 占用位置点 */\r\n    Points: Array<Array<number>>;\r\n    options_num: number;\r\n}\r\n\r\nexport class WeaponData {\r\n    private _isSelect: boolean = false;//是否选中武器\r\n    private _weaponCfgMapData: Map<string, WeaponModel> = new Map(); // key=> group + '|' + level \r\n    private _weaponGridData: Map<number, WeaponModel> = new Map();//可用格子数据\r\n\r\n    public get isSelect() {\r\n        return this._isSelect;\r\n    }\r\n\r\n    public set isSelect(value: boolean) {\r\n        this._isSelect = value;\r\n    }\r\n\r\n    public init() {\r\n        const blockItems = Templates.TbBlockItem.getDataList();\r\n        const weaponModels: WeaponModel[] = [];\r\n        for (let i = 0; i < blockItems.length; i++) {\r\n            const weaponModel: WeaponModel = {\r\n                tempId: blockItems[i].id,\r\n                Name: blockItems[i].name,\r\n                Res: blockItems[i].icon,// TODO:\r\n                weaponGroupNum: blockItems[i].group,\r\n                itemType: blockItems[i].type.toString(),//TODO: 枚举类型,\r\n                Type: blockItems[i].shapeType[0] + '_' + blockItems[i].shapeType[1],\r\n                SkillId: blockItems[i].targetId,\r\n                Level: blockItems[i].level,\r\n                Points: blockItems[i].shapeTypePara,\r\n                options_num: blockItems[i].optionsNum\r\n            }\r\n            weaponModels.push(weaponModel);\r\n        }\r\n\r\n        for (let index = 0; index < weaponModels.length; index++) {\r\n            const element = weaponModels[index];\r\n            // TODO: 少一个配件\r\n            switch (element.itemType) {\r\n                case '1':\r\n                    let key = element.weaponGroupNum + '|' + element.Level;\r\n                    this._weaponCfgMapData.set(key, element);\r\n                    break;\r\n                case '2':\r\n                    break;\r\n                case '3':\r\n                    this._weaponGridData.set(element.tempId, element);\r\n                    break;\r\n            }\r\n        }\r\n    }\r\n\r\n    public getWeaponCfgByLevel(level: number, group: number) {\r\n        let key = group + '|' + level;\r\n        return this._weaponCfgMapData.get(key)\r\n    }\r\n\r\n    /* 通过level检测是否有该等级的装备 */\r\n    public checkWeaponByLevel(level: number, group: number) {\r\n        let key = group + '|' + level;\r\n        if (this._weaponCfgMapData.has(key)) {\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    public getWeaponCfgById(id: number) {\r\n        const blockItem = Templates.TbBlockItem.getDataMap().get(id)!;\r\n        const weaponModel: WeaponModel = {\r\n            tempId: blockItem.id,\r\n            Name: blockItem.name,\r\n            Res: blockItem.icon,// TODO:\r\n            weaponGroupNum: blockItem.group,\r\n            itemType: blockItem.type.toString(),//TODO: 枚举类型,\r\n            Type: blockItem.shapeType[0] + '_' + blockItem.shapeType[1],\r\n            SkillId: blockItem.targetId,\r\n            Level: blockItem.level,\r\n            Points: blockItem.shapeTypePara,\r\n            options_num: blockItem.optionsNum\r\n        }\r\n\r\n        return weaponModel;\r\n    }\r\n\r\n    private getWeaponCfgData() {\r\n        let data = [];\r\n        const blockItems = Templates.TbBlockItem.getDataList();\r\n        const weaponModels: WeaponModel[] = [];\r\n        for (let i = 0; i < blockItems.length; i++) {\r\n            const weaponModel: WeaponModel = {\r\n                tempId: blockItems[i].id,\r\n                Name: blockItems[i].name,\r\n                Res: blockItems[i].icon,// TODO:\r\n                weaponGroupNum: blockItems[i].group,\r\n                itemType: blockItems[i].type.toString(),//TODO: 枚举类型,\r\n                Type: blockItems[i].shapeType[0] + '_' + blockItems[i].shapeType[1],\r\n                SkillId: blockItems[i].targetId,\r\n                Level: blockItems[i].level,\r\n                Points: blockItems[i].shapeTypePara,\r\n                options_num: blockItems[i].optionsNum\r\n            }\r\n            weaponModels.push(weaponModel);\r\n        }\r\n        for (let i = 0; i < weaponModels.length; i++) {\r\n            const element = weaponModels[i];\r\n            if (element.itemType) {\r\n                data.push(element);\r\n            }\r\n        }\r\n\r\n        return data;\r\n    }\r\n\r\n    /**\r\n     * TODO:暂时拿的是三件\r\n     * @returns \r\n     */\r\n    public getWeaponPool() {\r\n        let arr: Array<number> = [];\r\n        const blockItems = Templates.TbBlockItem.getDataList();\r\n        const weaponModels: WeaponModel[] = [];\r\n        for (let i = 0; i < blockItems.length; i++) {\r\n            const weaponModel: WeaponModel = {\r\n                tempId: blockItems[i].id,\r\n                Name: blockItems[i].name,\r\n                Res: blockItems[i].icon,\r\n                weaponGroupNum: blockItems[i].group,\r\n                itemType: blockItems[i].type.toString(),//TODO: 枚举类型,\r\n                Type: blockItems[i].shapeType[0] + '_' + blockItems[i].shapeType[1],\r\n                SkillId: blockItems[i].targetId,\r\n                Level: blockItems[i].level,\r\n                Points: blockItems[i].shapeTypePara,\r\n                options_num: blockItems[i].optionsNum\r\n            }\r\n            weaponModels.push(weaponModel);\r\n        }\r\n        for (let i = 0; i < weaponModels.length; i++) {\r\n            const element = weaponModels[i];\r\n            if (element.Level == 1 && element.itemType == '1') {\r\n                arr.push(element.tempId);\r\n                if (arr.length == 3) {\r\n                    break;\r\n                }\r\n            }\r\n\r\n        }\r\n        return arr;\r\n    }\r\n\r\n    /**\r\n     * 检测大数组数据中是否存在区域数据\r\n     * @param matrix 大数组区域数据 (0:占有 1:未占有)\r\n     * @param region  待检测的区域数据\r\n     * @returns \r\n     */\r\n    private countRegionOccurrences(matrix: number[][], region: number[][]): number {\r\n        let count = 0;\r\n        const regionRows = region.length;\r\n        const regionCols = region[0].length;\r\n        for (let i = 0; i <= matrix.length - regionRows; i++) {\r\n            for (let j = 0; j <= matrix[0].length - regionCols; j++) {\r\n                let match = true;\r\n                for (let r = 0; r < regionRows; r++) {\r\n                    for (let c = 0; c < regionCols; c++) {\r\n                        if (matrix[i + r][j + c] !== region[r][c]) {\r\n                            match = false;\r\n                            break;\r\n                        }\r\n                    }\r\n                    if (!match) {\r\n                        break;\r\n                    }\r\n                }\r\n                if (match) {\r\n                    count++;\r\n                }\r\n            }\r\n        }\r\n        return count;\r\n    }\r\n\r\n\r\n    /* 通过权重获取可以放置的id  */\r\n    public getPlaceGridIdByWeigh(matrix: number[][]) {\r\n        let weaponData: Array<WeaponModel> = [];\r\n        //找出可以放置的格子\r\n        if (this._weaponGridData.size) {\r\n            this._weaponGridData.forEach((weaponCfg, key) => {\r\n                let count = this.countRegionOccurrences(matrix, weaponCfg.Points);\r\n                if (count) {\r\n                    weaponData.push(weaponCfg);\r\n                }\r\n            })\r\n        }\r\n        let placeId = 0;\r\n        if (weaponData.length) {\r\n            let start = 0;\r\n            let end = 0;\r\n            let sum = 0;\r\n            for (let i = 0; i < weaponData.length; i++) {\r\n                const element = weaponData[i];\r\n                sum += element.options_num;\r\n            }\r\n            let rand = Math.floor(Math.random() * sum);\r\n            let index = 0;\r\n            weaponData.some((item, idx) => {\r\n                end = start + item.options_num;\r\n                if (rand >= start && rand < end) {\r\n                    index = idx;\r\n                    return true;\r\n                }\r\n                start = end;\r\n            })\r\n            placeId = weaponData[index].tempId;\r\n        }\r\n        return placeId;\r\n    }\r\n\r\n    clear() {\r\n        this._isSelect = false;\r\n    }\r\n\r\n    private static _instance: WeaponData = null!;\r\n    public static get instance(): WeaponData {\r\n        if (!this._instance) {\r\n            this._instance = new WeaponData();\r\n        }\r\n        return this._instance;\r\n    }\r\n\r\n}\r\n\r\nexport class CoinObj {\r\n    wpos: Vec3 = new Vec3();//金币坐标\r\n    num: number = 0;//金币数量\r\n}\r\n\r\n\r\n"]}