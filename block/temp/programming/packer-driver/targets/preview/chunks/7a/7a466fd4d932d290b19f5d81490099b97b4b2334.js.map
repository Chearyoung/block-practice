{"version":3,"sources":["file:///Users/jhh/Desktop/projects/block_project/block-practice/block/assets/script/block/Data/GridData.ts"],"names":["GridData","GridObj","_decorator","Component","Templates","ccclass","property","_curGrid","_gridMapData","_bagCfg","_gridRowLen","_gridColLen","_gridWidth","_gredHeight","_space","_curWeaponTildeIndex","_gridEditMode","instance","_instance","bagCfg","gridWidth","gridHeight","init","initGridMapData","initGridItemData","n","blockGrid","TbBlockGrid","getDataMap","get","privateGrid","map","row","String","expandFactor","getExpandFactor","expandPrivateGrid","privateGridLength","length","oldN","i","addGridItemData","Id","id","name","private_gridLen","privateGridLen","max_gridLen","maxGridLen","private_gridWidth","privateGridWidth","private_gredHeight","private_space","privateSpace","picture","parseInt","private_grid","max_grid","maxGrid","row_col","split","Number","matrix","count","expandMatrix","top","bottom","left","right","col","toString"],"mappings":";;;iHAqBaA,Q,EA8JAC,O;;;;;;;;;;;;;;;;;;AAnLJC,MAAAA,U,OAAAA,U;AAAYC,MAAAA,S,OAAAA,S;;AACZC,MAAAA,S,iBAAAA,S;;;;;;;;;OACH;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBJ,U;;0BAmBjBF,Q,GAAN,MAAMA,QAAN,CAAe;AAAA;AAAA,eACVO,QADU,GACC,GADD;AACK;AADL,eAEVC,YAFU,GAE2B,CAAC,CAAC,GAAD,EAAM,GAAN,EAAW,GAAX,CAAD,EAAkB,CAAC,GAAD,EAAM,GAAN,EAAW,GAAX,CAAlB,EAAmC,CAAC,GAAD,EAAM,GAAN,EAAW,GAAX,CAAnC,CAF3B;AAEiF;AAFjF,eAGVC,OAHU,GAGU,IAHV;AAGgB;AAHhB,eAIVC,WAJU,GAII,CAJJ;AAIO;AAJP,eAKVC,WALU,GAKI,CALJ;AAKO;AALP,eAMVC,UANU,GAMG,EANH;AAMM;AANN,eAOVC,WAPU,GAOI,EAPJ;AAOO;AAPP,eAQVC,MARU,GAQD,EARC;AAQE;AARF,eASVC,oBATU,GAS4B,EAT5B;AAS+B;AAT/B,eAWVC,aAXU,GAWe,KAXf;AAAA;;AAeQ,mBAARC,QAAQ,GAAa;AACnC,cAAI,CAAC,KAAKC,SAAV,EAAqB;AACjB,iBAAKA,SAAL,GAAiB,IAAIlB,QAAJ,EAAjB;AACH;;AACD,iBAAO,KAAKkB,SAAZ;AACH;;AAEgB,YAANC,MAAM,GAAG;AAChB,iBAAO,KAAKV,OAAZ;AACH;;AAEmB,YAATW,SAAS,GAAG;AACnB,iBAAO,KAAKR,UAAZ;AACH;;AAEoB,YAAVS,UAAU,GAAG;AACpB,iBAAO,KAAKR,WAAZ;AACH;;AAEMS,QAAAA,IAAI,GAAG;AACV,eAAKC,eAAL;AACA,eAAKC,gBAAL;AACH;;AAEOD,QAAAA,eAAe,GAAG;AACtB,cAAME,CAAC,GAAG,CAAV;AACA,cAAMC,SAAS,GAAG;AAAA;AAAA,sCAAUC,WAAV,CAAsBC,UAAtB,GAAmCC,GAAnC,CAAuC,KAAKtB,QAA5C,CAAlB;AACA,cAAMuB,WAAW,GAAGJ,SAAS,CAACI,WAAV,CAAsBC,GAAtB,CAA0BC,GAAG,IAAIA,GAAG,CAACD,GAAJ,CAAQE,MAAR,CAAjC,CAApB;AACA,cAAMC,YAAY,GAAG,KAAKC,eAAL,CAAqBL,WAArB,EAAkCL,CAAlC,CAArB;AACA,cAAIW,iBAA6B,GAAGN,WAApC,CALsB,CAOtB;;AACA,cAAIO,iBAAiB,GAAGP,WAAW,CAACQ,MAApC;AACA,cAAIC,IAAI,GAAG,CAAX;;AACA,eAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGN,YAAY,GAAG,CAAnC,EAAsCM,CAAC,EAAvC,EAA2C;AACvCJ,YAAAA,iBAAiB,GAAG,KAAKK,eAAL,CAAqBX,WAArB,EAAkC,CAACO,iBAAiB,GAAG,CAArB,IAA0B,CAA1B,GAA8B,CAAhE,CAApB;AACAE,YAAAA,IAAI,IAAI,CAACF,iBAAiB,GAAG,CAArB,IAA0B,CAA1B,GAA8B,CAAtC;AACAA,YAAAA,iBAAiB;AACpB;;AACDD,UAAAA,iBAAiB,GAAG,KAAKK,eAAL,CAAqBL,iBAArB,EAAwCX,CAAC,GAAGc,IAA5C,CAApB;AAEA,eAAK9B,OAAL,GAAe;AACXiC,YAAAA,EAAE,EAAEhB,SAAS,CAACiB,EADH;AAEXC,YAAAA,IAAI,EAAElB,SAAS,CAACkB,IAFL;AAGXC,YAAAA,eAAe,EAAGnB,SAAS,CAACoB,cAAV,CAAyB,CAAzB,IAA8BZ,YAAY,GAAG,CAA9C,GAAmD,GAAnD,IAA0DR,SAAS,CAACoB,cAAV,CAAyB,CAAzB,IAA8BZ,YAAY,GAAG,CAAvG,CAHN;AAIXa,YAAAA,WAAW,EAAErB,SAAS,CAACsB,UAAV,CAAqB,CAArB,IAA0B,GAA1B,GAAgCtB,SAAS,CAACsB,UAAV,CAAqB,CAArB,CAJlC;AAKXC,YAAAA,iBAAiB,EAAEvB,SAAS,CAACwB,gBAAV,CAA2B,CAA3B,CALR;AAMXC,YAAAA,kBAAkB,EAAEzB,SAAS,CAACwB,gBAAV,CAA2B,CAA3B,CANT;AAOXE,YAAAA,aAAa,EAAE1B,SAAS,CAAC2B,YAPd;AAQXC,YAAAA,OAAO,EAAEC,QAAQ,CAAC7B,SAAS,CAAC4B,OAAX,CARN;AASXE,YAAAA,YAAY,EAAEpB,iBATH;AAUXqB,YAAAA,QAAQ,EAAE/B,SAAS,CAACgC,OAAV,CAAkB3B,GAAlB,CAAsBC,GAAG,IAAIA,GAAG,CAACD,GAAJ,CAAQE,MAAR,CAA7B;AAVC,WAAf;;AAYA,cAAI0B,OAAO,GAAG,KAAKlD,OAAL,CAAaoC,eAAb,CAA6Be,KAA7B,CAAmC,GAAnC,CAAd;;AACA,eAAKpD,YAAL,GAAoB,KAAKC,OAAL,CAAa+C,YAAjC;AACA,eAAK5C,UAAL,GAAkB,KAAKH,OAAL,CAAawC,iBAA/B;AACA,eAAKpC,WAAL,GAAmB,KAAKJ,OAAL,CAAa0C,kBAAhC;AACA,eAAKrC,MAAL,GAAc,KAAKL,OAAL,CAAa2C,aAA3B;AACA,eAAKzC,WAAL,GAAmBkD,MAAM,CAACF,OAAO,CAAC,CAAD,CAAR,CAAzB;AACA,eAAKjD,WAAL,GAAmBmD,MAAM,CAACF,OAAO,CAAC,CAAD,CAAR,CAAzB;AACH;;AAEOnC,QAAAA,gBAAgB,GAAG,CAE1B;;AAEOW,QAAAA,eAAe,CAAC2B,MAAD,EAAqBrC,CAArB,EAAwC;AAC3D,cAAIA,CAAC,IAAI,CAAT,EAAY,OAAO,CAAP;AACZ,cAAIS,YAAY,GAAG,CAAnB,CAF2D,CAErC;;AACtB,cAAI6B,KAAK,GAAG,CAAC,IAAID,MAAM,CAACxB,MAAZ,IAAsB,CAAtB,GAA0B,CAAtC;;AACA,iBAAOyB,KAAK,GAAGtC,CAAf,EAAkB;AACdS,YAAAA,YAAY;AACZ6B,YAAAA,KAAK,IAAI,CAAC7B,YAAY,GAAG,CAAf,GAAmB4B,MAAM,CAACxB,MAA3B,IAAqC,CAArC,GAAyC,CAAlD;AACH;;AAED,iBAAOJ,YAAP;AACH;AAGD;;;AACQO,QAAAA,eAAe,CAACqB,MAAD,EAAqBrC,CAArB,EAA4C;AAC/D,cAAIA,CAAC,IAAI,CAAT,EAAY,OAAOqC,MAAP;AACZA,UAAAA,MAAM,GAAG,KAAKE,YAAL,CAAkBF,MAAlB,EAA0B,CAA1B,CAAT;AAEA,cAAIG,GAAG,GAAG,CAAV;AACA,cAAIC,MAAM,GAAGJ,MAAM,CAACxB,MAAP,GAAgB,CAA7B;AACA,cAAI6B,IAAI,GAAG,CAAX;AACA,cAAIC,KAAK,GAAGN,MAAM,CAAC,CAAD,CAAN,CAAUxB,MAAV,GAAmB,CAA/B;AAEA,cAAIyB,KAAK,GAAG,CAAZ;;AACA,iBAAOE,GAAG,IAAIC,MAAP,IAAiBC,IAAI,IAAIC,KAAhC,EAAuC;AACnC;AACA,iBAAK,IAAI5B,CAAC,GAAG2B,IAAb,EAAmB3B,CAAC,IAAI4B,KAAxB,EAA+B5B,CAAC,EAAhC,EAAoC;AAChC,kBAAIuB,KAAK,GAAG,CAAR,IAAaA,KAAK,IAAItC,CAA1B,EAA6B;AACzBqC,gBAAAA,MAAM,CAACI,MAAD,CAAN,CAAe1B,CAAf,IAAoB,GAApB;AACH;;AACDuB,cAAAA,KAAK;AACR;;AACDG,YAAAA,MAAM,GAR6B,CAQzB;AAEV;;AACA,iBAAK,IAAI1B,EAAC,GAAG0B,MAAb,EAAqB1B,EAAC,IAAIyB,GAAL,IAAYE,IAAI,IAAIC,KAAzC,EAAgD5B,EAAC,EAAjD,EAAqD;AACjD,kBAAIuB,KAAK,GAAG,CAAR,IAAaA,KAAK,IAAItC,CAA1B,EAA6B;AACzBqC,gBAAAA,MAAM,CAACtB,EAAD,CAAN,CAAU4B,KAAV,IAAmB,GAAnB;AACH;;AACDL,cAAAA,KAAK;AACR;;AACDK,YAAAA,KAAK,GAjB8B,CAiB1B;AAET;;AACA,iBAAK,IAAI5B,GAAC,GAAG4B,KAAb,EAAoB5B,GAAC,IAAI2B,IAAL,IAAaF,GAAG,IAAIC,MAAxC,EAAgD1B,GAAC,EAAjD,EAAqD;AACjD,kBAAIuB,KAAK,GAAG,CAAR,IAAaA,KAAK,IAAItC,CAA1B,EAA6B;AACzBqC,gBAAAA,MAAM,CAACG,GAAD,CAAN,CAAYzB,GAAZ,IAAiB,GAAjB;AACH;;AACDuB,cAAAA,KAAK;AACR;;AACDE,YAAAA,GAAG,GA1BgC,CA0B5B;AAEP;;AACA,iBAAK,IAAIzB,GAAC,GAAGyB,GAAb,EAAkBzB,GAAC,IAAI0B,MAAL,IAAeC,IAAI,IAAIC,KAAzC,EAAgD5B,GAAC,EAAjD,EAAqD;AACjD,kBAAIuB,KAAK,GAAG,CAAR,IAAaA,KAAK,IAAItC,CAA1B,EAA6B;AACzBqC,gBAAAA,MAAM,CAACtB,GAAD,CAAN,CAAU2B,IAAV,IAAkB,GAAlB;AACH;;AACDJ,cAAAA,KAAK;AACR;;AACDI,YAAAA,IAAI,GAnC+B,CAmC3B;AACX;;AAED,cAAI1C,CAAC,IAAIqC,MAAM,CAACxB,MAAP,GAAgB,CAAhB,GAAoB,CAA7B,EAAgC;AAC5BwB,YAAAA,MAAM,CAACA,MAAM,CAACxB,MAAP,GAAgB,CAAjB,CAAN,CAA0B,CAA1B,IAA+B,GAA/B;AACH;;AAED,iBAAOwB,MAAP;AACH;;AApJiB,O;;AAWqB;AAX9B9D,MAAAA,Q,CAcMkB,S,GAAsB,I;;yBAgJ5BjB,O,GAAN,MAAMA,OAAN,SAAsBE,SAAtB,CAAgC;AAAA;AAAA;AAAA,eACnC6B,GADmC,GACrB,CADqB;AAAA,eAEnCqC,GAFmC,GAErB,CAFqB;AAAA;;AAGnCC,QAAAA,QAAQ,GAAW;AACf,qCAAyB,KAAKtC,GAA9B,eAA2C,KAAKqC,GAAhD;AACH;;AALkC,O","sourcesContent":["import { _decorator, Component, Node } from 'cc';\nimport { Templates } from \"../../manager/TemplateMgr\";\nconst { ccclass, property } = _decorator;\n\nexport interface BagModel {\n    ClassName?: string;\n    Id: number;\n    name: string;\n    private_gridLen: string;\n    max_gridLen: string;\n    private_gridWidth: number;\n    private_gredHeight: number;\n    private_space: number;\n    //武器资源缩放大小\n    picture: number;\n    //拥有格子数据\n    private_grid: Array<Array<string>>;\n    //最大格子数据\n    max_grid: Array<Array<string>>;\n}\n\nexport class GridData {\n    private _curGrid = 100;//当前位置表id\n    private _gridMapData: Array<Array<string>> = [['0', '0', '0'], ['0', '0', '0'], ['0', '0', '0']];  //格子地图数据  0:有格子 '':没有格子   value=>武器唯一id\n    private _bagCfg: BagModel = null!;//背包配置数据\n    private _gridRowLen = 3; //格子行长度(每行多少个)\n    private _gridColLen = 3; //格子列长度(每列多少个)\n    private _gridWidth = 94;//格子宽度\n    private _gredHeight = 94;//格子高度\n    private _space = 10;//格子间隔\n    private _curWeaponTildeIndex: Array<number> = [];//当前武器位置索引\n\n    private _gridEditMode: boolean = false;//是否为格子编辑模式\n\n\n    private static _instance: GridData = null!;\n    public static get instance(): GridData {\n        if (!this._instance) {\n            this._instance = new GridData();\n        }\n        return this._instance;\n    }\n\n    public get bagCfg() {\n        return this._bagCfg;\n    }\n\n    public get gridWidth() {\n        return this._gridWidth;\n    }\n\n    public get gridHeight() {\n        return this._gredHeight;\n    }\n\n    public init() {\n        this.initGridMapData();\n        this.initGridItemData();\n    }\n\n    private initGridMapData() {\n        const n = 8;\n        const blockGrid = Templates.TbBlockGrid.getDataMap().get(this._curGrid)!;\n        const privateGrid = blockGrid.privateGrid.map(row => row.map(String));\n        const expandFactor = this.getExpandFactor(privateGrid, n);\n        let expandPrivateGrid: string[][] = privateGrid;\n\n        // 动态扩展,逆时针增加\n        let privateGridLength = privateGrid.length;\n        let oldN = 0;\n        for (let i = 0; i < expandFactor - 1; i++) {\n            expandPrivateGrid = this.addGridItemData(privateGrid, (privateGridLength + 2) * 4 - 4);\n            oldN += (privateGridLength + 2) * 4 - 4;\n            privateGridLength++;\n        }\n        expandPrivateGrid = this.addGridItemData(expandPrivateGrid, n - oldN);\n\n        this._bagCfg = {\n            Id: blockGrid.id,\n            name: blockGrid.name,\n            private_gridLen: (blockGrid.privateGridLen[0] + expandFactor * 2) + '_' + (blockGrid.privateGridLen[1] + expandFactor * 2),\n            max_gridLen: blockGrid.maxGridLen[0] + '_' + blockGrid.maxGridLen[1],\n            private_gridWidth: blockGrid.privateGridWidth[0],\n            private_gredHeight: blockGrid.privateGridWidth[1],\n            private_space: blockGrid.privateSpace,\n            picture: parseInt(blockGrid.picture),\n            private_grid: expandPrivateGrid,\n            max_grid: blockGrid.maxGrid.map(row => row.map(String))\n        }\n        let row_col = this._bagCfg.private_gridLen.split('_');\n        this._gridMapData = this._bagCfg.private_grid;\n        this._gridWidth = this._bagCfg.private_gridWidth;\n        this._gredHeight = this._bagCfg.private_gredHeight;\n        this._space = this._bagCfg.private_space;\n        this._gridColLen = Number(row_col[0]);\n        this._gridRowLen = Number(row_col[1]);\n    }\n\n    private initGridItemData() {\n\n    }\n\n    private getExpandFactor(matrix: string[][], n: number): number {\n        if (n == 0) return 0;\n        let expandFactor = 1; // 扩展因子\n        let count = (2 + matrix.length) * 4 - 4;\n        while (count < n) {\n            expandFactor++;\n            count += (expandFactor * 2 + matrix.length) * 4 - 4;\n        }\n\n        return expandFactor;\n    }\n\n\n    /**增加角色的背包格子 */\n    private addGridItemData(matrix: string[][], n: number): string[][] {\n        if (n == 0) return matrix;\n        matrix = this.expandMatrix(matrix, 1);\n\n        let top = 0;\n        let bottom = matrix.length - 1;\n        let left = 0;\n        let right = matrix[0].length - 1;\n\n        let count = 0;\n        while (top <= bottom && left <= right) {\n            // 从左到右（底部行）\n            for (let i = left; i <= right; i++) {\n                if (count > 0 && count <= n) {\n                    matrix[bottom][i] = '0';\n                }\n                count++;\n            }\n            bottom--; // 缩小底部边界\n\n            // 从下到上（最右侧列）\n            for (let i = bottom; i >= top && left <= right; i--) {\n                if (count > 0 && count <= n) {\n                    matrix[i][right] = '0';\n                }\n                count++;\n            }\n            right--; // 缩小右侧边界\n\n            // 从右到左（顶部行）\n            for (let i = right; i >= left && top <= bottom; i--) {\n                if (count > 0 && count <= n) {\n                    matrix[top][i] = '0';\n                }\n                count++;\n            }\n            top++; // 缩小顶部边界\n\n            // 从上到下（最左侧列）\n            for (let i = top; i <= bottom && left <= right; i++) {\n                if (count > 0 && count <= n) {\n                    matrix[i][left] = '0';\n                }\n                count++;\n            }\n            left++; // 缩小左侧边界\n        }\n\n        if (n == matrix.length * 4 - 4) {\n            matrix[matrix.length - 1][0] = '0';\n        }\n\n        return matrix;\n    }\n\n\n    \n\n}\n\n\n\n\nexport class GridObj extends Component {\n    row: number = 0;\n    col: number = 0;\n    toString(): string {\n        return `GridObj { row: ${this.row}, col: ${this.col} }`;\n    }\n}\n\n"]}