{"version":3,"sources":["file:///Users/jhh/Desktop/projects/block_project/block-practice/block/assets/script/Weapon/WeaponBgItem.ts"],"names":["_decorator","Component","game","instantiate","Layout","resources","Sprite","SpriteFrame","UIOpacity","UITransform","v2","Vec3","WeaponData","GridData","GridObj","Constants","EventConstant","ccclass","property","WeaponBgItem","_touchStatus","_weaponKey","_weaponCfg","_point","_pointGridObj","_placeStatus","_isTouch","point","weaponCfg","weaponKey","placeStatus","value","init","node","getChildByName","initWeaponSize","setPointPosArr","setGridIcon","setNodeAngel","typeArr","Type","split","rowLen","Number","colLen","size","instance","getGridSizeByRowCol","scale","iconScale","getComponent","setContentSize","setPosition","width","height","icon","setScale","Points","i","length","item","j","element","gridObj","row","col","push","path","weaponIconPath","Res","load","err","content","spriteFrame","iconList","parent","row_col","latticePoints","spacingX","space","spacingY","updateLayout","active","opacity","angle","onGridRemove","id","emit","ADD_REMOVE_WEAPON_LIST","onPlaceFinish","PLACE_GRID_END","onTouchStart","wpos","touchPos","convertToNodeSpaceAR","x","y","checkPointinGrid","isSelect","TOUCH_WEAPONBG","TouchStatus","START","PLACE_GRID_START","pos","onTouchMove","MOVE","PLACE_GRID_MOVE","onTouchEnd","END","onTouchCancle","CANCEL","onEnable","on","GAME_TOUCH_START","GAME_TOUCH_MOVE","GAME_TOUCH_END","GAME_TOUCH_CANCLE","onDisable","off"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAASA,MAAAA,U,OAAAA,U;AAAmBC,MAAAA,S,OAAAA,S;AAAWC,MAAAA,I,OAAAA,I;AAAMC,MAAAA,W,OAAAA,W;AAAaC,MAAAA,M,OAAAA,M;AAAcC,MAAAA,S,OAAAA,S;AAAWC,MAAAA,M,OAAAA,M;AAAQC,MAAAA,W,OAAAA,W;AAA2BC,MAAAA,S,OAAAA,S;AAAWC,MAAAA,W,OAAAA,W;AAAaC,MAAAA,E,OAAAA,E;AAAcC,MAAAA,I,OAAAA,I;;AACnJC,MAAAA,U,iBAAAA,U;;AACAC,MAAAA,Q,iBAAAA,Q;AAAUC,MAAAA,O,iBAAAA,O;;AACVC,MAAAA,S,iBAAAA,S;;AACAC,MAAAA,a,iBAAAA,a;;;;;;;;;OACH;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBlB,U;;8BAGjBmB,Y,WADZF,OAAO,CAAC,YAAD,C,UAEHC,QAAQ,CAACZ,MAAD,C,2BAFb,MACaa,YADb,SACkClB,SADlC,CAC4C;AAAA;AAAA;;AAAA;;AAAA,eAIhCmB,YAJgC,GAIT,CAJS;AAIP;AAJO,eAKhCC,UALgC,GAKX,EALW;AAKR;AALQ,eAMhCC,UANgC,GAMN,IANM;AAAA,eAOhCC,MAPgC,GAOjB,IAPiB;AAAA,eAQhCC,aARgC,GAQA,EARA;AAQG;AARH,eAUhCC,YAVgC,GAUR,IAVQ;AAUF;AAVE,eAWhCC,QAXgC,GAWZ,KAXY;AAAA;;AAWN;AAElB,YAALC,KAAK,GAAG;AACf,iBAAO,KAAKJ,MAAZ;AACH;;AAEmB,YAATK,SAAS,GAAG;AACnB,iBAAO,KAAKN,UAAZ;AACH;;AAEmB,YAATO,SAAS,GAAG;AACnB,iBAAO,KAAKR,UAAZ;AACH;;AAEqB,YAAXS,WAAW,CAACC,KAAD,EAAiB;AACnC,eAAKN,YAAL,GAAoBM,KAApB;AACH;;AAEMC,QAAAA,IAAI,CAACJ,SAAD,EAAyBC,SAAzB,EAA4CC,WAA5C,EAAkE;AACzE,eAAKN,aAAL,GAAqB,EAArB;AACA,eAAKC,YAAL,GAAoBK,WAApB;AACA,eAAKT,UAAL,GAAkBQ,SAAlB;AACA,eAAKP,UAAL,GAAkBM,SAAlB;AACA,eAAKL,MAAL,GAAc,KAAKU,IAAL,CAAUC,cAAV,CAAyB,OAAzB,CAAd;AACA,eAAKC,cAAL;AACA,eAAKC,cAAL;AACA,eAAKC,WAAL;AACA,eAAKC,YAAL;AACH;AAED;;;AACQH,QAAAA,cAAc,GAAG;AACrB,cAAII,OAAO,GAAG,KAAKjB,UAAL,CAAgBkB,IAAhB,CAAqBC,KAArB,CAA2B,GAA3B,CAAd;;AACA,cAAIC,MAAM,GAAGC,MAAM,CAACJ,OAAO,CAAC,CAAD,CAAR,CAAnB;AACA,cAAIK,MAAM,GAAGD,MAAM,CAACJ,OAAO,CAAC,CAAD,CAAR,CAAnB;AACA,cAAIM,IAAI,GAAG;AAAA;AAAA,oCAASC,QAAT,CAAkBC,mBAAlB,CAAsCL,MAAtC,EAA8CE,MAA9C,CAAX;;AACA,cAAIC,IAAI,IAAI,IAAZ,EAAkB;AACd,gBAAIG,KAAK,GAAG;AAAA;AAAA,sCAASF,QAAT,CAAkBG,SAA9B;AACA,iBAAKhB,IAAL,CAAUiB,YAAV,CAAuBzC,WAAvB,EAAqC0C,cAArC,CAAoDN,IAApD;AACA,iBAAKlB,KAAL,CAAWyB,WAAX,CAAuB,CAACP,IAAI,CAACQ,KAAN,GAAc,CAArC,EAAwCR,IAAI,CAACS,MAAL,GAAc,CAAtD;AACA,iBAAKC,IAAL,CAAUtB,IAAV,CAAeuB,QAAf,CAAwBR,KAAxB,EAA+BA,KAA/B,EAAsCA,KAAtC;AACH;AACJ;AAED;;;AACQZ,QAAAA,cAAc,GAAG;AACrB,eAAKZ,aAAL,GAAqB,EAArB;AACA,cAAIG,KAAK,GAAG,KAAKL,UAAL,CAAgBmC,MAA5B;;AACA,eAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG/B,KAAK,CAACgC,MAA1B,EAAkCD,CAAC,EAAnC,EAAuC;AACnC,gBAAME,IAAI,GAAGjC,KAAK,CAAC+B,CAAD,CAAlB;;AACA,iBAAK,IAAIG,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGD,IAAI,CAACD,MAAzB,EAAiCE,CAAC,EAAlC,EAAsC;AAClC,kBAAMC,OAAO,GAAGF,IAAI,CAACC,CAAD,CAApB;;AACA,kBAAIC,OAAJ,EAAa;AACT,oBAAIC,OAAO,GAAG;AAAA;AAAA,yCAAd;AACAA,gBAAAA,OAAO,CAACC,GAAR,GAAcN,CAAd;AACAK,gBAAAA,OAAO,CAACE,GAAR,GAAcJ,CAAd;;AACA,qBAAKrC,aAAL,CAAmB0C,IAAnB,CAAwBH,OAAxB;AACH;AACJ;AACJ;AACJ;AAED;;;AACQ1B,QAAAA,WAAW,GAAG;AAClB,cAAI8B,IAAI,GAAG;AAAA;AAAA,sCAAUC,cAAV,GAA2B,KAAKxC,SAAL,CAAeyC,GAA1C,GAAgD,cAA3D;AACAhE,UAAAA,SAAS,CAACiE,IAAV,CAAeH,IAAf,EAAqB5D,WAArB,EAAkC,CAACgE,GAAD,EAAoBC,OAApB,KAA6C;AAC3E,iBAAKjB,IAAL,CAAUkB,WAAV,GAAwBD,OAAxB,CAD2E,CAE3E;;AACA,gBAAIE,QAAQ,GAAG,KAAKnB,IAAL,CAAUtB,IAAV,CAAe0C,MAA9B;AACA,gBAAIC,OAAO,GAAG,KAAKhD,SAAL,CAAeY,IAAf,CAAoBC,KAApB,CAA0B,GAA1B,CAAd;AACA,gBAAII,IAAI,GAAG;AAAA;AAAA,sCAASC,QAAT,CAAkBC,mBAAlB,CAAsCJ,MAAM,CAACiC,OAAO,CAAC,CAAD,CAAR,CAA5C,EAA0DjC,MAAM,CAACiC,OAAO,CAAC,CAAD,CAAR,CAAhE,CAAX;;AACA,gBAAIF,QAAQ,IAAI,IAAhB,EAAsB;AAClB,kBAAIG,aAAa,GAAG,KAAKjD,SAAL,CAAe6B,MAAnC;AACAiB,cAAAA,QAAQ,CAACxB,YAAT,CAAsB9C,MAAtB,EAA+B0E,QAA/B,GAA0C;AAAA;AAAA,wCAAShC,QAAT,CAAkBiC,KAA5D;AACAL,cAAAA,QAAQ,CAACxB,YAAT,CAAsB9C,MAAtB,EAA+B4E,QAA/B,GAA0C;AAAA;AAAA,wCAASlC,QAAT,CAAkBiC,KAA5D;AACAL,cAAAA,QAAQ,CAACxB,YAAT,CAAsBzC,WAAtB,EAAoC4C,KAApC,GAA4CR,IAAI,CAACQ,KAAjD;AACAqB,cAAAA,QAAQ,CAACxB,YAAT,CAAsB9C,MAAtB,EAA+B6E,YAA/B,CAA4C,IAA5C;;AACA,mBAAK,IAAIvB,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGmB,aAAa,CAAClB,MAAlC,EAA0CD,CAAC,EAA3C,EAA+C;AAC3C,oBAAMI,OAAO,GAAGe,aAAa,CAACnB,CAAD,CAA7B;;AACA,qBAAK,IAAIG,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGC,OAAO,CAACH,MAA5B,EAAoCE,CAAC,EAArC,EAAyC;AACrC,sBAAM9B,KAAK,GAAG+B,OAAO,CAACD,CAAD,CAArB;AACA,sBAAID,IAAI,GAAGzD,WAAW,CAAC,KAAKoD,IAAL,CAAUtB,IAAX,CAAtB;AACA2B,kBAAAA,IAAI,CAACsB,MAAL,GAAc,IAAd;AACAtB,kBAAAA,IAAI,CAACe,MAAL,GAAcD,QAAd;AACAd,kBAAAA,IAAI,CAACV,YAAL,CAAkB1C,SAAlB,EAA8B2E,OAA9B,GAAwCpD,KAAK,GAAG,GAAH,GAAS,CAAtD;AACH;AAEJ;AACJ;AAEJ,WAzBD;AA0BH;;AAEOO,QAAAA,YAAY,GAAG;AACnB,cAAI8C,KAAK,GAAG,KAAK3D,YAAL,GAAoB,CAApB,GAAwB,EAApC;AACA,eAAKQ,IAAL,CAAUmD,KAAV,GAAkBA,KAAlB;AACH;AAED;;;AACQC,QAAAA,YAAY,CAACC,EAAD,EAAa;AAC7B,cAAI,KAAKzD,SAAL,IAAkByD,EAAtB,EAA0B;AACtB;AACApF,YAAAA,IAAI,CAACqF,IAAL,CAAU;AAAA;AAAA,gDAAcC,sBAAxB,EAAgD,KAAKvD,IAArD;AACA,iBAAKH,WAAL,GAAmB,KAAnB;AACA,iBAAKQ,YAAL;AACH;AACJ;AAGD;;;AACQmD,QAAAA,aAAa,GAAG;AACpB;AACAvF,UAAAA,IAAI,CAACqF,IAAL,CAAU;AAAA;AAAA,8CAAcG,cAAxB,EAAwC,IAAxC;AACH;AAGD;;AACA;;;AACQC,QAAAA,YAAY,CAACC,IAAD,EAAc;AAC9B;AACA,cAAIC,QAAQ,GAAG,KAAKlE,KAAL,CAAWuB,YAAX,CAAwBzC,WAAxB,EAAsCqF,oBAAtC,CAA2D,IAAInF,IAAJ,CAASiF,IAAI,CAAEG,CAAf,EAAkBH,IAAI,CAAEI,CAAxB,EAA2B,CAA3B,CAA3D,CAAf;;AACA,cAAI;AAAA;AAAA,oCAASlD,QAAT,CAAkBmD,gBAAlB,CAAmCvF,EAAE,CAACmF,QAAQ,CAACE,CAAV,EAAaF,QAAQ,CAACG,CAAtB,CAArC,EAA+D,KAAKxE,aAApE,KAAsF,CAAC;AAAA;AAAA,wCAAWsB,QAAX,CAAoBoD,QAA/G,EAAyH;AACrHhG,YAAAA,IAAI,CAACqF,IAAL,CAAU;AAAA;AAAA,gDAAcY,cAAxB,EAAuC,IAAvC;AACA,iBAAKzE,QAAL,GAAgB,IAAhB;AACA;AAAA;AAAA,0CAAWoB,QAAX,CAAoBoD,QAApB,GAA+B,IAA/B;AACA,iBAAK9E,YAAL,GAAoBgF,WAAW,CAACC,KAAhC,CAJqH,CAKrH;;AACA,iBAAKvE,WAAL,GAAmB,IAAnB;AACA,iBAAKQ,YAAL;AACApC,YAAAA,IAAI,CAACqF,IAAL,CAAU;AAAA;AAAA,gDAAce,gBAAxB,EAA0C,IAA1C;AACA,gBAAIC,GAAG,GAAG,KAAKtE,IAAL,CAAU0C,MAAV,CAAkBzB,YAAlB,CAA+BzC,WAA/B,EAA6CqF,oBAA7C,CAAkE,IAAInF,IAAJ,CAASiF,IAAI,CAAEG,CAAf,EAAkBH,IAAI,CAAEI,CAAxB,EAA2B,CAA3B,CAAlE,CAAV;AACA,iBAAK/D,IAAL,CAAUmB,WAAV,CAAsBmD,GAAG,CAACR,CAA1B,EAA6BQ,GAAG,CAACP,CAAjC;AACH;AACJ;;AAEOQ,QAAAA,WAAW,CAACZ,IAAD,EAAc;AAC7B,cAAI,KAAKlE,QAAT,EAAmB;AACf,iBAAKN,YAAL,GAAoBgF,WAAW,CAACK,IAAhC;AACA,gBAAIF,GAAG,GAAG,KAAKtE,IAAL,CAAU0C,MAAV,CAAkBzB,YAAlB,CAA+BzC,WAA/B,EAA6CqF,oBAA7C,CAAkE,IAAInF,IAAJ,CAASiF,IAAI,CAAEG,CAAf,EAAkBH,IAAI,CAAEI,CAAxB,EAA2B,CAA3B,CAAlE,CAAV;AACA,iBAAK/D,IAAL,CAAUmB,WAAV,CAAsBmD,GAAG,CAACR,CAA1B,EAA6BQ,GAAG,CAACP,CAAjC;AACA9F,YAAAA,IAAI,CAACqF,IAAL,CAAU;AAAA;AAAA,gDAAcmB,eAAxB,EAAyC,IAAzC;AACH;AACJ;;AAEOC,QAAAA,UAAU,CAACf,IAAD,EAAc;AAC5B,cAAI,KAAKlE,QAAT,EAAmB;AACf,iBAAKA,QAAL,GAAgB,KAAhB;AACA;AAAA;AAAA,0CAAWoB,QAAX,CAAoBoD,QAApB,GAA+B,KAA/B;AACA,iBAAKT,aAAL;AACA,iBAAKrE,YAAL,GAAoBgF,WAAW,CAACQ,GAAhC;AACH;AACJ;;AAEOC,QAAAA,aAAa,CAACjB,IAAD,EAAa;AAC9B,cAAI,KAAKlE,QAAT,EAAmB;AACf,iBAAKA,QAAL,GAAgB,KAAhB;AACA;AAAA;AAAA,0CAAWoB,QAAX,CAAoBoD,QAApB,GAA+B,KAA/B;AACA,iBAAK9E,YAAL,GAAoBgF,WAAW,CAACU,MAAhC;AACA5G,YAAAA,IAAI,CAACqF,IAAL,CAAU;AAAA;AAAA,gDAAcC,sBAAxB,EAAgD,KAAKvD,IAArD;AACH;AACJ;;AAES8E,QAAAA,QAAQ,GAAS;AACvB7G,UAAAA,IAAI,CAAC8G,EAAL,CAAQ;AAAA;AAAA,8CAAcC,gBAAtB,EAAwC,KAAKtB,YAA7C,EAA2D,IAA3D;AACAzF,UAAAA,IAAI,CAAC8G,EAAL,CAAQ;AAAA;AAAA,8CAAcE,eAAtB,EAAuC,KAAKV,WAA5C,EAAyD,IAAzD;AACAtG,UAAAA,IAAI,CAAC8G,EAAL,CAAQ;AAAA;AAAA,8CAAcG,cAAtB,EAAsC,KAAKR,UAA3C,EAAuD,IAAvD;AACAzG,UAAAA,IAAI,CAAC8G,EAAL,CAAQ;AAAA;AAAA,8CAAcI,iBAAtB,EAAyC,KAAKT,UAA9C,EAA0D,IAA1D;AACH;;AAESU,QAAAA,SAAS,GAAS;AACxBnH,UAAAA,IAAI,CAACoH,GAAL,CAAS;AAAA;AAAA,8CAAcL,gBAAvB,EAAyC,KAAKtB,YAA9C,EAA4D,IAA5D;AACAzF,UAAAA,IAAI,CAACoH,GAAL,CAAS;AAAA;AAAA,8CAAcJ,eAAvB,EAAwC,KAAKV,WAA7C,EAA0D,IAA1D;AACAtG,UAAAA,IAAI,CAACoH,GAAL,CAAS;AAAA;AAAA,8CAAcH,cAAvB,EAAuC,KAAKR,UAA5C,EAAwD,IAAxD;AACAzG,UAAAA,IAAI,CAACoH,GAAL,CAAS;AAAA;AAAA,8CAAcF,iBAAvB,EAA0C,KAAKT,UAA/C,EAA2D,IAA3D;AACH;;AAzLuC,O;;;;;iBAEjB,I;;;;6BA2LfP,W,0BAAAA,W;AAAAA,QAAAA,W,CAAAA,W;AAAAA,QAAAA,W,CAAAA,W;AAAAA,QAAAA,W,CAAAA,W;AAAAA,QAAAA,W,CAAAA,W;AAAAA,QAAAA,W,CAAAA,W;eAAAA,W","sourcesContent":["import { _decorator, Color, Component, game, instantiate, Layout, Node, resources, Sprite, SpriteFrame, Tween, tween, UIOpacity, UITransform, v2, v3, Vec2, Vec3} from 'cc';\r\nimport { WeaponData, WeaponModel } from '../Data/WeaponData';\r\nimport { GridData, GridObj } from '../Data/GridData';\r\nimport { Constants } from '../Constants';\r\nimport { EventConstant } from '../EventConstant';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('WeaponItem')\r\nexport class WeaponBgItem extends Component {\r\n    @property(Sprite)\r\n    private icon: Sprite = null!;\r\n\r\n    private _touchStatus: number = 0;//当前触摸状态\r\n    private _weaponKey: string = '';//唯一值\r\n    private _weaponCfg: WeaponModel = null!;\r\n    private _point: Node = null!;\r\n    private _pointGridObj: Array<GridObj> = [];//占用点位置\r\n\r\n    private _placeStatus: boolean = true; //true:放置  false:卸下\r\n    private _isTouch: boolean = false;//是否被点击\r\n\r\n    public get point() {\r\n        return this._point;\r\n    }\r\n\r\n    public get weaponCfg() {\r\n        return this._weaponCfg;\r\n    }\r\n\r\n    public get weaponKey() {\r\n        return this._weaponKey;\r\n    }\r\n\r\n    public set placeStatus(value: boolean) {\r\n        this._placeStatus = value;\r\n    }\r\n\r\n    public init(weaponCfg: WeaponModel, weaponKey: string, placeStatus: boolean) {\r\n        this._pointGridObj = [];\r\n        this._placeStatus = placeStatus;\r\n        this._weaponKey = weaponKey;\r\n        this._weaponCfg = weaponCfg;\r\n        this._point = this.node.getChildByName('point')!;\r\n        this.initWeaponSize();\r\n        this.setPointPosArr();\r\n        this.setGridIcon();\r\n        this.setNodeAngel();\r\n    }\r\n\r\n    /* 初始武器格子尺寸 */\r\n    private initWeaponSize() {\r\n        let typeArr = this._weaponCfg.Type.split('_');\r\n        let rowLen = Number(typeArr[1]);\r\n        let colLen = Number(typeArr[0]);\r\n        let size = GridData.instance.getGridSizeByRowCol(rowLen, colLen);\r\n        if (size != null) {\r\n            let scale = GridData.instance.iconScale;\r\n            this.node.getComponent(UITransform)!.setContentSize(size);\r\n            this.point.setPosition(-size.width / 2, size.height / 2);\r\n            this.icon.node.setScale(scale, scale, scale);\r\n        }\r\n    }\r\n\r\n    /* 设置点坐标 */\r\n    private setPointPosArr() {\r\n        this._pointGridObj = [];\r\n        let point = this._weaponCfg.Points;\r\n        for (let i = 0; i < point.length; i++) {\r\n            const item = point[i];\r\n            for (let j = 0; j < item.length; j++) {\r\n                const element = item[j];\r\n                if (element) {\r\n                    let gridObj = new GridObj();\r\n                    gridObj.row = i;\r\n                    gridObj.col = j;\r\n                    this._pointGridObj.push(gridObj);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    /* 设置武器图标 */\r\n    private setGridIcon() {\r\n        let path = Constants.weaponIconPath + this.weaponCfg.Res + '/spriteFrame';\r\n        resources.load(path, SpriteFrame, (err: Error | null, content: SpriteFrame) => {\r\n            this.icon.spriteFrame = content;\r\n            //设置格子\r\n            let iconList = this.icon.node.parent!;\r\n            let row_col = this.weaponCfg.Type.split('_');\r\n            let size = GridData.instance.getGridSizeByRowCol(Number(row_col[1]), Number(row_col[0]));\r\n            if (iconList != null) {\r\n                let latticePoints = this.weaponCfg.Points;\r\n                iconList.getComponent(Layout)!.spacingX = GridData.instance.space;\r\n                iconList.getComponent(Layout)!.spacingY = GridData.instance.space;\r\n                iconList.getComponent(UITransform)!.width = size.width;\r\n                iconList.getComponent(Layout)!.updateLayout(true);\r\n                for (let i = 0; i < latticePoints.length; i++) {\r\n                    const element = latticePoints[i];\r\n                    for (let j = 0; j < element.length; j++) {\r\n                        const value = element[j];\r\n                        let item = instantiate(this.icon.node);\r\n                        item.active = true;\r\n                        item.parent = iconList;\r\n                        item.getComponent(UIOpacity)!.opacity = value ? 255 : 0;\r\n                    }\r\n\r\n                }\r\n            }\r\n\r\n        });\r\n    }\r\n\r\n    private setNodeAngel() {\r\n        let angle = this._placeStatus ? 0 : 10;\r\n        this.node.angle = angle;\r\n    }\r\n\r\n    /* 格子卸下 */\r\n    private onGridRemove(id: string) {\r\n        if (this.weaponKey == id) {\r\n            //添加到待上阵武器列表\r\n            game.emit(EventConstant.ADD_REMOVE_WEAPON_LIST, this.node);\r\n            this.placeStatus = false;\r\n            this.setNodeAngel();\r\n        }\r\n    }\r\n\r\n\r\n    /* 放置完成 */\r\n    private onPlaceFinish() {\r\n        //放置完成\r\n        game.emit(EventConstant.PLACE_GRID_END, this);\r\n    }\r\n\r\n\r\n    /* 关闭多触碰 */\r\n    /* 触摸点击 */\r\n    private onTouchStart(wpos?: Vec2) {\r\n        //是否触摸到武器(只能选中一个)\r\n        let touchPos = this.point.getComponent(UITransform)!.convertToNodeSpaceAR(new Vec3(wpos!.x, wpos!.y, 0));\r\n        if (GridData.instance.checkPointinGrid(v2(touchPos.x, touchPos.y), this._pointGridObj) && !WeaponData.instance.isSelect) {\r\n            game.emit(EventConstant.TOUCH_WEAPONBG,this);\r\n            this._isTouch = true;\r\n            WeaponData.instance.isSelect = true;\r\n            this._touchStatus = TouchStatus.START;\r\n            //编辑格子\r\n            this.placeStatus = true;\r\n            this.setNodeAngel();\r\n            game.emit(EventConstant.PLACE_GRID_START, this);\r\n            let pos = this.node.parent!.getComponent(UITransform)!.convertToNodeSpaceAR(new Vec3(wpos!.x, wpos!.y, 0));\r\n            this.node.setPosition(pos.x, pos.y);\r\n        }\r\n    }\r\n\r\n    private onTouchMove(wpos?: Vec2) {\r\n        if (this._isTouch) {\r\n            this._touchStatus = TouchStatus.MOVE;\r\n            let pos = this.node.parent!.getComponent(UITransform)!.convertToNodeSpaceAR(new Vec3(wpos!.x, wpos!.y, 0));\r\n            this.node.setPosition(pos.x, pos.y);\r\n            game.emit(EventConstant.PLACE_GRID_MOVE, this);\r\n        }\r\n    }\r\n\r\n    private onTouchEnd(wpos?: Vec2) {\r\n        if (this._isTouch) {\r\n            this._isTouch = false;\r\n            WeaponData.instance.isSelect = false;\r\n            this.onPlaceFinish();\r\n            this._touchStatus = TouchStatus.END;\r\n        }\r\n    }\r\n\r\n    private onTouchCancle(wpos: Vec2) {\r\n        if (this._isTouch) {\r\n            this._isTouch = false;\r\n            WeaponData.instance.isSelect = false;\r\n            this._touchStatus = TouchStatus.CANCEL;\r\n            game.emit(EventConstant.ADD_REMOVE_WEAPON_LIST, this.node)\r\n        }\r\n    }\r\n\r\n    protected onEnable(): void {\r\n        game.on(EventConstant.GAME_TOUCH_START, this.onTouchStart, this);\r\n        game.on(EventConstant.GAME_TOUCH_MOVE, this.onTouchMove, this);\r\n        game.on(EventConstant.GAME_TOUCH_END, this.onTouchEnd, this);\r\n        game.on(EventConstant.GAME_TOUCH_CANCLE, this.onTouchEnd, this);\r\n    }\r\n\r\n    protected onDisable(): void {\r\n        game.off(EventConstant.GAME_TOUCH_START, this.onTouchStart, this);\r\n        game.off(EventConstant.GAME_TOUCH_MOVE, this.onTouchMove, this);\r\n        game.off(EventConstant.GAME_TOUCH_END, this.onTouchEnd, this);\r\n        game.off(EventConstant.GAME_TOUCH_CANCLE, this.onTouchEnd, this);\r\n    }\r\n}\r\n\r\n\r\nexport enum TouchStatus {\r\n    DEFAULT,\r\n    START,\r\n    MOVE,\r\n    END,\r\n    CANCEL\r\n}\r\n\r\n\r\n"]}