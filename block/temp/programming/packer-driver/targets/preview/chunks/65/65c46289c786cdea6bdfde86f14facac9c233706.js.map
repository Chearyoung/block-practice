{"version":3,"sources":["file:///Users/wangzhaoye/block-practice/block/assets/script/Weapon/WeaponItem.ts"],"names":["_decorator","Color","Component","game","Label","Prefab","ProgressBar","Sprite","SpriteFrame","Tween","tween","UITransform","v2","v3","Vec3","WeaponData","GridData","GridObj","Constants","OpenPopupManager","EventConstant","oops","ccclass","property","WeaponItem","_touchStatus","_weaponKey","_weaponCfg","_point","_pointGridObj","_isShake","_placeStatus","_isTouch","point","weaponCfg","weaponKey","placeStatus","value","init","node","getChildByName","level","string","Level","progressBar","progress","initWeaponSize","setPointPosArr","setWeaponIcon","setNodeAngel","typeArr","Type","split","rowLen","Number","colLen","size","instance","getGridSizeByRowCol","scale","iconScale","getComponent","setContentSize","setPosition","width","height","icon","setScale","Points","i","length","item","j","element","gridObj","row","col","push","path","weaponIconPath","Res","res","load","err","content","spriteFrame","bar","contentSize","setBuildWeaponPos","key","pos","setIconYellow","color","fromHEX","setIconDefault","onSetIconStatus","id","status","angle","onUpdateProgressBar","onSetStatusInit","stopAllByTarget","onSetIconShake","posX","time","by","position","union","repeatForever","start","onPenWeaponPopup","TouchStatus","START","itemPath","onWeaponRemove","emit","ADD_REMOVE_WEAPON_LIST","onWeapoPreRemove","ADD_PRE_WEAPON_LIST","onPlaceFinish","MOVE","WEAPON_PlACE","onWeaponUpgrade","isInner","group","weaponGroupNum","getWeaponCfgByLevel","updateGridItemData","tempId","setSynEffect","synPath","onTouchStart","wpos","touchPos","convertToNodeSpaceAR","x","y","checkPointinGrid","isSelect","gridEditMode","onTouchMove","parent","WEAPON_MOVE","onTouchEnd","showWeaponDetailPopup","END","onTouchCancle","CANCEL","SET_BATTLE_BTN_STATUS","onEnable","on","GAME_TOUCH_START","GAME_TOUCH_MOVE","GAME_TOUCH_END","GAME_TOUCH_CANCLE","WEAPON_REMOVE","WEAPON_ICON_STATUS","WEAPON_ICON_STATUS_INIT","WEAPON_SHAKE","WEAPON_UPGRADE","WEAPON_PROGRESS_BAR","onDisable","off"],"mappings":"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","sourcesContent":["import { _decorator, Color, Component, EventTouch, game, Input, input, instantiate, Label, Node, Prefab, ProgressBar, Sprite, SpriteFrame, Tween, tween, UITransform, v2, v3, Vec2, Vec3 } from 'cc';\r\nimport { WeaponData, WeaponModel } from '../Data/WeaponData';\r\nimport { SynItem } from '../Battle/SynItem';\r\nimport { GridData, GridObj } from '../Data/GridData';\r\nimport { Constants } from '../../Constants';\r\nimport { OpenPopupManager } from '../../Frame/OpenPopupManager';\r\nimport { EventConstant } from '../../../../constant/EventConstant';\r\nimport { oops } from '../../../../../script-oops/core/Oops';\r\n\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('WeaponItem')\r\nexport class WeaponItem extends Component {\r\n    @property(Label)\r\n    private level: Label = null!;\r\n    @property(Sprite)\r\n    private icon: Sprite = null!;\r\n    @property(Sprite)\r\n    private bar: Sprite = null!;\r\n    @property(ProgressBar)\r\n    private progressBar: ProgressBar = null!;\r\n\r\n    private _touchStatus: number = 0;//当前触摸状态\r\n    private _weaponKey: string = '';//唯一值\r\n    private _weaponCfg: WeaponModel = null!;\r\n    private _point: Node = null!;\r\n    private _pointGridObj: Array<GridObj> = [];//占用点位置\r\n    private _isShake: boolean = false;//是否抖动\r\n    private _placeStatus: boolean = true; //true:放置  false:卸下\r\n    private _isTouch: boolean = false;//是否被点击\r\n\r\n    public get point() {\r\n        return this._point;\r\n    }\r\n\r\n    public get weaponCfg() {\r\n        return this._weaponCfg;\r\n    }\r\n\r\n    public get weaponKey() {\r\n        return this._weaponKey;\r\n    }\r\n\r\n    public set placeStatus(value: boolean) {\r\n        this._placeStatus = value;\r\n    }\r\n\r\n    public init(weaponCfg: WeaponModel, weaponKey: string, placeStatus: boolean) {\r\n        this._pointGridObj = [];\r\n        this._placeStatus = placeStatus;\r\n        this._weaponKey = weaponKey;\r\n        this._weaponCfg = weaponCfg;\r\n        this._isShake = false;\r\n        this._point = this.node.getChildByName('point')!;\r\n        this.level.string = `Lv${weaponCfg.Level}`;\r\n        this.progressBar.progress = 0;\r\n        this.initWeaponSize();\r\n        this.setPointPosArr();\r\n        this.setWeaponIcon();\r\n        this.setNodeAngel();\r\n    }\r\n\r\n    /* 初始武器格子尺寸 */\r\n    private initWeaponSize() {\r\n        let typeArr = this._weaponCfg.Type.split('_');\r\n        let rowLen = Number(typeArr[1]);\r\n        let colLen = Number(typeArr[0]);\r\n        let size = GridData.instance.getGridSizeByRowCol(rowLen, colLen);\r\n        let scale = GridData.instance.iconScale;\r\n        if (size != null) {\r\n            this.node.getComponent(UITransform)!.setContentSize(size);\r\n            this.point.setPosition(-size.width / 2, size.height / 2);\r\n            this.icon.node.setScale(scale, scale, scale);\r\n        }\r\n    }\r\n\r\n    /* 设置点坐标 */\r\n    private setPointPosArr() {\r\n        this._pointGridObj = [];\r\n        let point = this._weaponCfg.Points;\r\n        for (let i = 0; i < point.length; i++) {\r\n            const item = point[i];\r\n            for (let j = 0; j < item.length; j++) {\r\n                const element = item[j];\r\n                if (element) {\r\n                    let gridObj = new GridObj();\r\n                    gridObj.row = i;\r\n                    gridObj.col = j;\r\n                    this._pointGridObj.push(gridObj);\r\n                }\r\n            }\r\n\r\n        }\r\n    }\r\n\r\n    /* 设置武器图标 */\r\n    private setWeaponIcon() {\r\n        let path = Constants.weaponIconPath + this.weaponCfg.Res + '/spriteFrame';\r\n        oops.res.load(path, SpriteFrame, (err: Error | null, content: SpriteFrame) => {\r\n            this.icon.spriteFrame = content;\r\n            this.bar.spriteFrame = content;\r\n            let size = this.icon.getComponent(UITransform)!.contentSize;\r\n            this.bar.node.setPosition(v3(0, -size.height / 2, 0));\r\n        })\r\n    }\r\n\r\n    /* 设置重组后武器的位置 */\r\n    public setBuildWeaponPos(key: string, pos: Vec3) {\r\n        if (this._weaponKey == key) {\r\n            this.node.setPosition(pos);\r\n        }\r\n    }\r\n\r\n    public setIconYellow() {\r\n        this.icon.getComponent(Sprite)!.color = new Color().fromHEX('dbc464');\r\n    }\r\n\r\n    public setIconDefault() {\r\n        this.icon.getComponent(Sprite)!.color = new Color().fromHEX('ffffff');\r\n    }\r\n\r\n    private onSetIconStatus(id?: string, status?: boolean) {\r\n        if (this.weaponKey == id) {\r\n            if (status) {\r\n                this.setIconYellow();\r\n            }\r\n            else {\r\n                this.setIconDefault();\r\n            }\r\n        }\r\n    }\r\n\r\n    public setNodeAngel() {\r\n        let angle = this._placeStatus ? 0 : 10;\r\n        this.node.angle = angle;\r\n    }\r\n\r\n    /* 更新技能进度条 */\r\n    private onUpdateProgressBar(value?: number, id?: string) {\r\n        if (this.weaponKey == id) {\r\n            this.progressBar.progress = value!;\r\n        }\r\n    }\r\n\r\n    private onSetStatusInit() {\r\n        this.setIconDefault();\r\n        this._isShake = false;\r\n        Tween.stopAllByTarget(this.icon.node);\r\n    }\r\n\r\n    private onSetIconShake(id?: string) {\r\n        if (this.weaponKey == id) {\r\n            //抖动\r\n            if (!this._isShake) {\r\n                this._isShake = true;\r\n                let posX = 5;\r\n                let time = 0.1;\r\n                this.icon.node.setPosition(0, 0, 0);\r\n                tween(this.icon.node).by(time, { position: v3(-posX, 0, 0) }).by(time, { position: v3(posX, 0, 0) }).by(time, { position: v3(posX, 0, 0) }).by(time, { position: v3(-posX, 0, 0) })\r\n                    .union().repeatForever().start();\r\n            }\r\n        }\r\n    }\r\n\r\n    /* 武器弹窗 */\r\n    private onPenWeaponPopup() {\r\n        if (this._touchStatus == TouchStatus.START) {\r\n            let path = Constants.itemPath + this.weaponCfg.Res;\r\n            //TODO显示弹窗\r\n        }\r\n    }\r\n\r\n    /* 武器卸下 */\r\n    private onWeaponRemove(id?: string) {\r\n        if (this.weaponKey == id) {\r\n            //添加到待上阵武器列表\r\n            game.emit(EventConstant.ADD_REMOVE_WEAPON_LIST, this.node);\r\n            this.placeStatus = false;\r\n            this.setNodeAngel();\r\n        }\r\n    }\r\n\r\n    /* 武器预卸下 */\r\n    private onWeapoPreRemove() {\r\n        if (this._touchStatus == TouchStatus.START) {\r\n            // console.log('武器预卸下');\r\n            //武器预卸下\r\n            game.emit(EventConstant.ADD_PRE_WEAPON_LIST, this.node);\r\n            this.placeStatus = true;\r\n            this.setNodeAngel();\r\n        }\r\n    }\r\n\r\n    /* 放置完成 */\r\n    private onPlaceFinish() {\r\n        if (this._touchStatus == TouchStatus.MOVE) {\r\n            //放置完成\r\n            // console.log('放置完成');\r\n            game.emit(EventConstant.WEAPON_PlACE, this);\r\n        }\r\n    }\r\n\r\n\r\n    /**\r\n     * 合成升级\r\n     * 1.合成后格子相同 直接合成\r\n     * 2.合成后格子不相同则直接卸下\r\n     * @param weaponKey 武器的唯一key\r\n     * @param isInner 内合成或者外合成\r\n     */\r\n    private onWeaponUpgrade(weaponKey?: string, isInner?: boolean) {\r\n        if (this._weaponKey == weaponKey) {\r\n            let level = this._weaponCfg.Level + 1;\r\n            let group = this._weaponCfg.weaponGroupNum;\r\n            this._weaponCfg = WeaponData.instance.getWeaponCfgByLevel(level, group)!;\r\n            this.level.string = `Lv${this._weaponCfg.Level}`;\r\n            GridData.instance.updateGridItemData(weaponKey, this._weaponCfg.tempId);\r\n            //播放合成特效\r\n            this.setSynEffect();\r\n            //设置资源\r\n            this.setWeaponIcon();\r\n        }\r\n    }\r\n\r\n    /* 设置合成特效 */\r\n    private setSynEffect() {\r\n        let path = Constants.synPath;\r\n\r\n        oops.res.load(path, Prefab, (err: Error | null, content: Prefab) => {\r\n            // let synItem = instantiate(content);\r\n            // synItem.parent = this.node;\r\n            // if (synItem.getComponent(SynItem) != null) {\r\n            //     synItem.getComponent(SynItem)!.init();\r\n            // }\r\n        });\r\n    }\r\n\r\n    /* 关闭多触碰 */\r\n    /* 触摸点击 */\r\n    private onTouchStart(wpos?: Vec2) {\r\n        //是否触摸到武器(只能选中一个)\r\n        let touchPos = this.point.getComponent(UITransform)!.convertToNodeSpaceAR(new Vec3(wpos!.x, wpos!.y, 0));\r\n        if (GridData.instance.checkPointinGrid(v2(touchPos.x, touchPos.y), this._pointGridObj) && !WeaponData.instance.isSelect && !GridData.instance.gridEditMode) {\r\n            this._isTouch = true;\r\n            WeaponData.instance.isSelect = true;\r\n            this._touchStatus = TouchStatus.START;\r\n        }\r\n    }\r\n\r\n    private onTouchMove(wpos?: Vec2) {\r\n        if (this._isTouch) {\r\n            this.onWeapoPreRemove();\r\n            this._touchStatus = TouchStatus.MOVE;\r\n            let pos = this.node.parent!.getComponent(UITransform)!.convertToNodeSpaceAR(new Vec3(wpos!.x, wpos!.y, 0));\r\n            this.node.setPosition(pos);\r\n            game.emit(EventConstant.WEAPON_MOVE, this);\r\n        }\r\n    }\r\n\r\n    private onTouchEnd(wpos?: Vec2) {\r\n        if (this._isTouch) {\r\n            if (this._touchStatus == TouchStatus.START) {\r\n                //弹出详情\r\n                OpenPopupManager.instance.showWeaponDetailPopup(this.weaponCfg);\r\n            }\r\n            this._isTouch = false;\r\n            WeaponData.instance.isSelect = false;\r\n            this.onPenWeaponPopup();\r\n            this.onPlaceFinish();\r\n            this._touchStatus = TouchStatus.END;\r\n        }\r\n    }\r\n\r\n    private onTouchCancle(wpos?: Vec2) {\r\n        if (this._isTouch) {\r\n            this._isTouch = false;\r\n            WeaponData.instance.isSelect = false;\r\n            this._touchStatus = TouchStatus.CANCEL;\r\n            //添加到待上阵武器列表\r\n            game.emit(EventConstant.ADD_REMOVE_WEAPON_LIST, this.node);\r\n            //设置战斗按钮状态\r\n            game.emit(EventConstant.SET_BATTLE_BTN_STATUS);\r\n        }\r\n    }\r\n\r\n    protected onEnable(): void {\r\n        game.on(EventConstant.GAME_TOUCH_START, this.onTouchStart, this);\r\n        game.on(EventConstant.GAME_TOUCH_MOVE, this.onTouchMove, this);\r\n        game.on(EventConstant.GAME_TOUCH_END, this.onTouchEnd, this);\r\n        game.on(EventConstant.GAME_TOUCH_CANCLE, this.onTouchEnd, this);\r\n\r\n        game.on(EventConstant.WEAPON_REMOVE, this.onWeaponRemove, this);\r\n        game.on(EventConstant.WEAPON_ICON_STATUS, this.onSetIconStatus, this);\r\n        game.on(EventConstant.WEAPON_ICON_STATUS_INIT, this.onSetStatusInit, this);\r\n        game.on(EventConstant.WEAPON_SHAKE, this.onSetIconShake, this);\r\n        game.on(EventConstant.WEAPON_UPGRADE, this.onWeaponUpgrade, this);\r\n        game.on(EventConstant.WEAPON_PROGRESS_BAR, this.onUpdateProgressBar, this);\r\n    }\r\n\r\n    protected onDisable(): void {\r\n        game.off(EventConstant.GAME_TOUCH_START, this.onTouchStart, this);\r\n        game.off(EventConstant.GAME_TOUCH_MOVE, this.onTouchMove, this);\r\n        game.off(EventConstant.GAME_TOUCH_END, this.onTouchEnd, this);\r\n        game.off(EventConstant.GAME_TOUCH_CANCLE, this.onTouchEnd, this);\r\n\r\n        game.off(EventConstant.WEAPON_REMOVE, this.onWeaponRemove, this);\r\n        game.off(EventConstant.WEAPON_ICON_STATUS, this.onSetIconStatus, this);\r\n        game.off(EventConstant.WEAPON_ICON_STATUS_INIT, this.onSetStatusInit, this);\r\n        game.off(EventConstant.WEAPON_SHAKE, this.onSetIconShake, this);\r\n        game.off(EventConstant.WEAPON_UPGRADE, this.onWeaponUpgrade, this);\r\n        // EventListener.off(GameEvent.WEAPON_PROGRESS_BAR, this.onUpdateProgressBar, this);\r\n    }\r\n}\r\n\r\n\r\nexport enum TouchStatus {\r\n    DEFAULT,\r\n    START,\r\n    MOVE,\r\n    END,\r\n    CANCEL\r\n}\r\n\r\n\r\n"]}