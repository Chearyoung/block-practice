{"version":3,"sources":["file:///Users/wangzhaoye/block-practice/block/assets/script/block/Game.ts"],"names":["_decorator","Component","Node","tween","v3","Input","director","Tween","game","GridMapManager","GridManager","WeaponManager","GameDefine","TemplateMgr","EventConstant","ccclass","property","Game","_battleMapUpPosY","_battleMapDownPosy","onLoad","gameTouch","init","scheduleOnce","instance","gridManager","gridMapManager","weaponManager","onTapBtn","setTweenAnim","removeWeaponList","main","duration","active","setScale","to","scale","easing","call","start","onGameStart","gameStart","gameOver","onGameOver","stopAll","clear","loadScene","onTouchStart","event","preventSwallow","wpos","getUILocation","emit","GAME_TOUCH_START","onTouchMove","GAME_TOUCH_MOVE","onTouchEnd","GAME_TOUCH_END","onTouchCancle","GAME_TOUCH_CANCLE","onEnable","gameCtrl","on","EventType","TOUCH_START","TOUCH_MOVE","TOUCH_END","TOUCH_CANCEL","GAME_OVER","GAME_TAP_BTN","onDisable","off"],"mappings":"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","sourcesContent":["import { _decorator, Component, Node, screen, Size, view, UITransform, tween, v3, EventTouch, Input, director, Button, Sprite, instantiate, Prefab, Vec3, Tween, game } from 'cc';\nimport { GridMapManager } from './Mgr/GridMapManager';\nimport { GridManager } from './Mgr/GridManager';\nimport { WeaponManager } from '../Mgr/WeaponManager';\nimport { GameDefine } from '../GameDefine';\nimport { TemplateMgr } from \"../Mgr/TemplateMgr\";\n// import { OpenPopupManager } from './Frame/OpenPopupManager';\n// import { oops } from '../../../script-oops/core/Oops';\n// import { UIID } from '../../config/GameUIConfig';\nimport { EventConstant } from '../EventConstant';\n// import { PopupManager } from './Frame/PopupManager';\nconst { ccclass, property } = _decorator;\n\n@ccclass('Game')\nexport class Game extends Component {\n    @property(Node)\n    gameCtrl: Node = null!;\n\n    @property(Node)\n    removeWeaponList: Node = null!;\n\n    // @property(Button)\n    // closeBtn: Button = null!;\n\n    // @property(Node)\n    // openBox: Node = null!;\n\n    @property(GridMapManager)\n    gridMapManager: GridMapManager = null!;\n\n    @property(GridManager)\n    gridManager: GridManager = null!;\n\n    @property(WeaponManager)\n    weaponManager: WeaponManager = null!;\n\n    private _battleMapUpPosY = 1200;\n    private _battleMapDownPosy = 200;\n\n    protected onLoad() {\n        GameDefine.gameTouch = false;\n        // OpenPopupManager.instance.showGamePopup();\n        this.init();\n\n        // this.closeBtn.node.on(Button.EventType.CLICK, () => {\n        //     oops.gui.remove(UIID.BlockUI, true);\n        //     game.emit(EventConstant.Event_UI_ResumeGame);\n        //     this.clear();\n        // }, this);\n    }\n\n    private init() {\n\n        this.scheduleOnce(() => {\n            // 加载配置表\n            TemplateMgr.instance().init(() => {\n                this.gridManager.init();\n                this.gridMapManager.init();\n                this.weaponManager.init();\n                this.onTapBtn();\n            })\n        }, 0.5)\n        \n    }\n\n    /* 触碰开始 */\n    private onTapBtn() {\n        GameDefine.gameTouch = true;\n        this.setTweenAnim(this.removeWeaponList, 0.3);\n    }\n\n    /* 设置动画 */\n    private setTweenAnim(main: Node, duration: number) {\n        main.active = true;\n        main.setScale(0.5, 0.5);\n        tween(main)\n            .to(duration, { scale: v3(1, 1, 1) }, { easing: 'backOut' })\n            .call(() => {\n                // 弹窗已完全展示\n            })\n            .start();\n    }\n\n\n    /**游戏开始 */\n    private onGameStart() {\n        GameDefine.gameTouch = false;\n        GameDefine.gameStart = true;\n        GameDefine.gameOver = false;\n    }\n\n    /**游戏结束 */\n    private onGameOver() {\n        GameDefine.gameTouch = false;\n        GameDefine.gameStart = false;\n        GameDefine.gameOver = true;\n        Tween.stopAll();\n        this.clear();\n        // PopupManager.instance.hideAll();\n        director.loadScene('Game');\n    }\n\n    /* 触摸点击 */\n    private onTouchStart(event: EventTouch) {\n        event.preventSwallow = true;\n        if (GameDefine.gameTouch) {\n            let wpos = event.getUILocation();\n            game.emit(EventConstant.GAME_TOUCH_START, wpos);\n        }\n    }\n\n    /* 触摸移动 */\n    private onTouchMove(event: EventTouch) {\n        event.preventSwallow = true;\n        if (GameDefine.gameTouch) {\n            let wpos = event.getUILocation();\n            game.emit(EventConstant.GAME_TOUCH_MOVE, wpos);\n        }\n    }\n\n    /* 触摸结束 */\n    private onTouchEnd(event: EventTouch) {\n        event.preventSwallow = true;\n        if (GameDefine.gameTouch) {\n            let wpos = event.getUILocation();\n            game.emit(EventConstant.GAME_TOUCH_END, wpos);\n        }\n    }\n\n    /* 触摸取消 */\n    private onTouchCancle(event: EventTouch) {\n        event.preventSwallow = true;\n        if (GameDefine.gameTouch) {\n            let wpos = event.getUILocation();\n            game.emit(EventConstant.GAME_TOUCH_CANCLE, wpos);\n        }\n    }\n\n    protected onEnable(): void {\n        this.gameCtrl.on(Input.EventType.TOUCH_START, this.onTouchStart, this);\n        this.gameCtrl.on(Input.EventType.TOUCH_MOVE, this.onTouchMove, this);\n        this.gameCtrl.on(Input.EventType.TOUCH_END, this.onTouchEnd, this);\n        this.gameCtrl.on(Input.EventType.TOUCH_CANCEL, this.onTouchCancle, this);\n        game.on(EventConstant.GAME_OVER, this.onGameOver, this);\n        game.on(EventConstant.GAME_TAP_BTN, this.onTapBtn, this);\n    }\n\n    protected onDisable(): void {\n        this.gameCtrl.off(Input.EventType.TOUCH_START, this.onTouchStart, this);\n        this.gameCtrl.off(Input.EventType.TOUCH_MOVE, this.onTouchMove, this);\n        this.gameCtrl.off(Input.EventType.TOUCH_END, this.onTouchEnd, this);\n        this.gameCtrl.off(Input.EventType.TOUCH_CANCEL, this.onTouchCancle, this);\n        game.off(EventConstant.GAME_OVER, this.onGameOver, this);\n        game.off(EventConstant.GAME_TAP_BTN, this.onTapBtn, this);\n    }\n\n    private clear() {\n        // 数据清理整理\n        this.gridManager.clear();\n        this.weaponManager.clear();\n    }\n}\n\n\n"]}